#chat?e&w&x=return `BEGIN INSTRUCTIONS:
  WE ARE HERE: <URL>${decodeURI(location.href)}</URL>

  WHERE IS HERE?
  We are in a hypertext operating system that reimagines the IndexedDB as the filesystem and the URL as the terminal interface. Like in Plan9's "everything is a file", here, "everything is a hyperlink" and you generate the code
  
  WHAT IS THE SOURCE?
  This is the sourcecode: <SOURCE>${S.innerText}</SOURCE>

  HOW IT WORKS:
  - your output will either be injected into the source code above or eval()'ed
    - your code is automatically wrapped in anonymous function
    - this is why you must output raw unescaped code DO NOT use '''javascript or '''html etc
  
  TASK:
  Generate a simple chat app:
    - use the global "os" instance
    - reuse this apps existing api/model, stored in "localStorage.k" and "localStorage.m"
    - use streaming mode for ai response
    - add input fields for to update api key and model for this chat only (do not override localStorage)
    - like with this app, if the hostname is "google" then use the google api otherwise use the openai standard endpoint (like in the source)
    - remember to send the whole chat history (just send it as one message with USER: AI:
    - do not return an entire html document, just the HTML tags for this and the script tag
&p=UPDATE:
  - this uses the operating systems echo hyperlink mechanism in a new browser tab to save
  - do not save anything to the os yourself directly, only use the hyperlink method
  - add field for filename, use YYMMDD-HHMMSS as default filename (don't just use placeholder actually show value)
  - replace spaces in filename with hyphens
  - use "os.write" to save
  - CTRL+ENTER to submit textarea (along with submit button)
NO TALKING, NO MARKDOWN, BEGIN CODE:
&p=FINAL DRAFT - DOUBLE CHECK:
  - please make sure you are sending the whole entire chat history, not most recent message
  - create an array of every user prompt and ai response and always send those all out with every message
  - visually separate user/ai messages
NO TALKING, NO MARKDOWN, IF NO CHANGES ARE NEEDED RETURN EVERYTHING AS, BEGIN CODE:
