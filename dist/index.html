<!DOCTYPE html><app id="A"></app><style>:root{color-scheme:dark}</style><script>D=document,J=JSON,L=localStorage,H=history,RS="replaceState",W=window,O=location.pathname.slice(1)||"os",F="files",ONS="onsuccess";class OS{constructor(){W.onhashchange=()=>this.run(),this.boot()}async boot(){if(await this.cdb(),!new URLSearchParams(location.hash.split("?")[1]).has("safe")){let t=(await this.keys()).filter(t=>t.startsWith("boot")).sort();for(let e of t)try{new Function(O,await this.read(e))(this)}catch(t){console.error(e,t)}}this.run()}cdb(){return new Promise(t=>{let e=indexedDB.open(O);e.onupgradeneeded=t=>t.target.result.createObjectStore(F),e[ONS]=e=>{this.db=e.target.result,t()}})}tx(t="readonly"){return this.db.transaction(F,t).objectStore(F)}write(t,e){return new Promise(a=>this.tx("readwrite").put(e,t)[ONS]=a)}read(t){return new Promise(e=>this.tx().get(t)[ONS]=t=>e(t.target.result))}keys(){return new Promise(t=>this.tx().getAllKeys()[ONS]=e=>t(e.target.result))}async run(){if(this.db||await this.cdb(),!location.hash)return H[RS](0,"","#home"),this.run();let t=location.hash.slice(1),[e,a]=t.split("?"),r=e,i=new URLSearchParams(a),s=!1;for(let[t,e]of i){if("a"==t&&(s="0"!=e),"f"==t&&(r=e),"kmsh".includes(t)&&L.setItem(t,e),"wru".includes(t)&&("r"==t&&(e=await this.read(e)||""),"u"==t&&(e=await(await fetch(e)).text()),s&&(e=(await this.read(r)||"")+e),await this.write(r,e)),"x"==t)try{let t=await this.read(r),a=await new Function(O,"v",e)(this,t);void 0!==a&&await this.write(r,a)}catch(t){console.error(t)}"p"==t&&await this.gen(r,e,s)}a&&H[RS](0,"","#"+e);let n=await this.read(e);n||(n=(await this.keys()).map(t=>`<a href="#${t}">${t}</a>`).join("<br>")),i.has("safe")?A.innerHTML=n:this.rehydrate(n)}rehydrate(t){A.innerHTML=t,A.querySelectorAll("script").forEach(t=>{let e=D.createElement("script");Array.from(t.attributes).forEach(t=>e.setAttribute(t.name,t.value)),e.text=t.textContent,t.replaceWith(e)})}async gen(t,e,a){let r,i,s,[n,o,h,c]=["k","m","s","h"].map(t=>L.getItem(t)),l=await this.read(t)||"",w="google"==c,d=`<SYS>${h}</SYS><FILE>${l}</FILE><REQ>${e}</REQ>`,u=w?`https://generativelanguage.googleapis.com/v1beta/models/${o}:generateContent?key=${n}`:c,g=w?{contents:[{parts:[{text:d}]}]}:{model:o,messages:[{role:"user",content:d}]},m={"Content-Type":"application/json"};!w&&n&&(m.Authorization=`Bearer ${n}`),A.innerHTML="Thinking...";try{r=await fetch(u,{method:"POST",headers:m,body:J.stringify(g)}),i=await r.json(),s=w?i.candidates?.[0]?.content?.parts?.[0]?.text:i.choices?.[0]?.message?.content,s&&(a&&(s=l+s),await this.write(t,s))}catch(t){A.innerHTML=t}}}os=new OS</script>