<!DOCTYPE html><style>:root{color-scheme:dark}</style><app></app><script>class OS{constructor(){this.dbName="os",this.storeName="files",this.root=document.querySelector("app"),this.plugins={},window.addEventListener("hashchange",()=>this.route()),this.boot()}async boot(){await this.connectDB(),await this.runBootloader(),await this.route()}connectDB(){return new Promise((t,e)=>{const o=indexedDB.open(this.dbName,1);o.onupgradeneeded=t=>{const e=t.target.result;e.objectStoreNames.contains(this.storeName)||e.createObjectStore(this.storeName)},o.onsuccess=e=>{this.db=e.target.result,t()},o.onerror=e})}async write(t,e){return new Promise(o=>{this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(e,t).onsuccess=o})}async read(t){return new Promise(e=>{this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).get(t).onsuccess=t=>e(t.target.result)})}async getKeys(){return new Promise(t=>{this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).getAllKeys().onsuccess=e=>t(e.target.result)})}use(t,e){this.plugins[t]=e,"function"==typeof e&&e(this)}async runBootloader(){const t=(await this.getKeys()).filter(t=>t.startsWith("boot")).sort();for(const e of t){const t=await this.read(e);try{new Function("os",t)(this)}catch(t){console.error(`[Boot Error] ${e}:`,t)}}}async route(){const t=window.location.hash.slice(1)||"home",[e,o]=t.split("?"),r=new URLSearchParams(o);if(r.has("w")&&(await this.write(e,r.get("w")),history.replaceState(null,"",`#${e}`)),r.has("apiKey")){localStorage.setItem("apiKey",r.get("apiKey")),r.delete("apiKey");const t=r.toString()?`${e}?${r.toString()}`:e;history.replaceState(null,"",`#${t}`)}if(r.has("apiModel")){localStorage.setItem("apiModel",r.get("apiModel")),r.delete("apiModel");const t=r.toString()?`${e}?${r.toString()}`:e;history.replaceState(null,"",`#${t}`)}const s=localStorage.getItem("apiKey"),a=localStorage.getItem("apiModel")||"gemini-3-pro-preview";if(r.has("p"))return s?void await this.generateAndRender(e,s,a,window.location.href):void this.render("\n                    <h3>Configuration Required</h3>\n                    <p>No API Key found. Please add <code>?apiKey=YOUR_KEY</code> to the URL.</p>\n                ");const n=await this.read(e);this.render(n||`\n            <h3>Error #0x404</h3>\n            <p>File #${e} does not exist yet.</p>\n            <p>Use <code>?w=content</code> to create it manually, or <code>?p=prompt</code> to generate it.</p>\n        `)}render(t){this.root.innerHTML=t,this.rehydrateScripts(this.root)}rehydrateScripts(t){t.querySelectorAll("script").forEach(t=>{const e=document.createElement("script");Array.from(t.attributes).forEach(t=>{e.setAttribute(t.name,t.value)}),e.textContent=t.textContent,t.parentNode.replaceChild(e,t)})}async generateAndRender(t,e,o,r){this.root.innerHTML="<i>Thinking...</i>";const s={contents:[{parts:[{text:`<SYSTEM>You are an OS. Generate a valid HTML/JS Single Page App.</SYSTEM><CONTEXT>${await this.read(t)||""}</CONTEXT><USER_REQUEST>${r}</USER_REQUEST>`}]}]};try{const r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${o}:streamGenerateContent?key=${e}&alt=sse`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok){const t=await r.text();throw new Error(`API Error ${r.status}: ${t}`)}const a=r.body.getReader(),n=new TextDecoder;let i="",c="";for(;;){const{done:t,value:e}=await a.read();if(t)break;i+=n.decode(e,{stream:!0});const o=i.split("\n");i=o.pop();for(const t of o)if(t.startsWith("data: "))try{const e=JSON.parse(t.slice(6)),o=e.candidates?.[0]?.content?.parts?.[0]?.text;o&&(c+=o,this.root.innerHTML=c)}catch(t){}}await this.write(t,c),this.rehydrateScripts(this.root),history.replaceState(null,"",`#${t}`)}catch(t){this.root.innerHTML=`<pre>${t.message}</pre>`}}}const os=new OS</script>