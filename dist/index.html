<!DOCTYPE html><style>:root{color-scheme:dark;font-family:monospace;white-space:pre-wrap}</style><app id="A"></app><script id="S">D=document,J=JSON,L=localStorage,H=history,RS="replaceState",W=window,O=location.pathname.slice(1)||"os",F="files",ONS="onsuccess";class OS{constructor(){W.onhashchange=()=>this.run(),this.boot()}async boot(){if(this.db=await this.cdb(),"os"!=O&&(this.os=await this.cdb("os")),!new URLSearchParams(location.hash.split("?")[1]).has("safe")){let t=IDBKeyRange.bound("boot","bootï¿¿"),e=await this.keys(t);this.os&&(e=[...new Set([...e,...await this.keys(t,this.os)])]);for(let t of e)try{new Function(O,await this.read(t))(this)}catch(e){console.error(t,e)}}this.run()}cdb(t=O){return new Promise(e=>{let a=indexedDB.open(t);a.onupgradeneeded=t=>t.target.result.createObjectStore(F),a[ONS]=t=>e(t.target.result)})}tx(t="readonly",e=this.db){return e.transaction(F,t).objectStore(F)}write(t,e){return new Promise(a=>this.tx("readwrite").put(e,t)[ONS]=a)}async read(t){return await this.get(t)||this.os&&await this.get(t,this.os)}get(t,e){return new Promise(a=>this.tx("readonly",e).get(t)[ONS]=t=>a(t.target.result))}keys(t,e){return new Promise(a=>this.tx("readonly",e).getAllKeys(t)[ONS]=t=>a(t.target.result))}async run(){if(this.db||(this.db=await this.cdb()),!location.hash)return H[RS](0,"","#home"),this.run();let t=location.hash.slice(1),[e,a]=t.split("?"),s=e,i=new URLSearchParams(a),r=await this.read(e)||"",n=!1;a&&this.write("H/"+Date.now(),t);for(let[t,e]of i){let a;if(a=await this.read("cmd/"+t))try{let t=await new Function(O,"v","arg",a)(this,r,e);void 0!==t&&(r=t)}catch(e){console.error(t,e)}else if("a"==t)n="0"!=e;else if("f"==t)s=e;else if("kmsh".includes(t))L.setItem(t,e);else if("erup".includes(t)){let a=e;"r"==t&&(a=await this.read(e)||""),"u"==t&&(a=await(await fetch(e)).text()),"p"==t&&(a=await this.gen(r,e)),r=n?r+a:a}else if("w"==t)await this.write(s,r);else if("x"==t)try{let t=await new Function(O,"v",e)(this,r);void 0!==t&&(r=t)}catch(t){console.error(t)}}a&&await this.write(s,r),a&&H[RS](0,"","#"+e);let o=await this.read(e)||"";i.has("safe")?A.innerHTML=o:this.rehydrate(o)}rehydrate(t){A.innerHTML=t,A.querySelectorAll("script").forEach(t=>{let e=D.createElement("script");Array.from(t.attributes).forEach(t=>e.setAttribute(t.name,t.value)),e.text=t.textContent,t.replaceWith(e)})}async gen(t,e){let a,s,i,[r,n,o,h]=["k","m","s","h"].map(t=>L.getItem(t)),c="google"==h,l=(o||"")+t+e,w=c?`https://generativelanguage.googleapis.com/v1beta/models/${n}:generateContent?key=${r}`:h,d=c?{contents:[{parts:[{text:l}]}]}:{model:n,messages:[{role:"user",content:l}]},u={"Content-Type":"application/json"};!c&&r&&(u.Authorization=`Bearer ${r}`),A.innerHTML="Thinking...";try{a=await fetch(w,{method:"POST",headers:u,body:J.stringify(d)}),s=await a.json(),i=c?s.candidates?.[0]?.content?.parts?.[0]?.text:s.choices?.[0]?.message?.content}catch(t){i=t.message}return i||""}}os=new OS</script>