<!DOCTYPE html><style>:root{color-scheme:dark}</style><app></app><script>(()=>{let t=document,e=window,r=e.location;new class{constructor(){this.name="os",this.storeName="files",this.root=t.querySelector("app"),this.plugins={},e.addEventListener("hashchange",()=>this.route()),this.boot()}async boot(){await this.connectDB(),await this.runBootloader(),await this.route()}connectDB(){return new Promise((t,e)=>{const r=indexedDB.open(this.name,1);r.onupgradeneeded=t=>{const e=t.target.result;e.objectStoreNames.contains(this.storeName)||e.createObjectStore(this.storeName)},r.onsuccess=e=>{this.db=e.target.result,t()},r.onerror=e})}dbTx(t,e="readonly"){return this.db.transaction(this.storeName,t).objectStore(this.storeName)}async write(t,e){return new Promise(r=>{this.dbTx("readwrite").put(e,t).onsuccess=r})}async read(t){return new Promise(e=>{this.dbTx().get(t).onsuccess=t=>e(t.target.result)})}async getKeys(){return new Promise(t=>{this.dbTx().getAllKeys().onsuccess=e=>t(e.target.result)})}use(t,e){this.plugins[t]=e,"function"==typeof e&&e(this)}async runBootloader(){const t=(await this.getKeys()).filter(t=>t.startsWith("boot")).sort();for(const e of t){const t=await this.read(e);try{new Function("os",t)(this)}catch(t){console.error(`[Boot Error] ${e}:`,t)}}}async route(){const t=r.hash.slice(1)||"home",[e,o]=t.split("?"),s=new URLSearchParams(o);if(s.has("w")&&(await this.write(e,s.get("w")),history.replaceState(null,"",`#${e}`)),s.has("apiKey")){localStorage.setItem("apiKey",s.get("apiKey")),s.delete("apiKey");const t=s.toString()?`${e}?${s.toString()}`:e;history.replaceState(null,"",`#${t}`)}if(s.has("apiModel")){localStorage.setItem("apiModel",s.get("apiModel")),s.delete("apiModel");const t=s.toString()?`${e}?${s.toString()}`:e;history.replaceState(null,"",`#${t}`)}const a=localStorage.getItem("apiKey"),n=localStorage.getItem("apiModel")||"gemini-3-pro-preview";if(s.has("p"))return a?void await this.generateAndRender(e,a,n,r.href):void this.render("\n                  <h3>Configuration Required</h3>\n                  <p>No API Key found. Please add <code>?apiKey=YOUR_KEY</code> to the URL.</p>\n              ");const i=await this.read(e);this.render(i||`\n        <h3>Error #0x404</h3>\n        <p>File #${e} does not exist yet.</p>\n        <p>Use <code>?w=content</code> to create it manually, or <code>?p=prompt</code> to generate it.</p>\n    `)}render(t){this.root.innerHTML=t,this.rehydrateScripts(this.root)}rehydrateScripts(e){e.querySelectorAll("script").forEach(e=>{const r=t.createElement("script");Array.from(e.attributes).forEach(t=>{r.setAttribute(t.name,t.value)}),r.textContent=e.textContent,e.parentNode.replaceChild(r,e)})}async generateAndRender(t,e,r,o){this.root.innerHTML="<i>Thinking...</i>";const s={contents:[{parts:[{text:`<SYSTEM>You are an OS. Generate a valid HTML/JS Single Page App.</SYSTEM><CONTEXT>${await this.read(t)||""}</CONTEXT><USER_REQUEST>${o}</USER_REQUEST>`}]}]};try{const o=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${r}:streamGenerateContent?key=${e}&alt=sse`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!o.ok){const t=await o.text();throw new Error(`API Error ${o.status}: ${t}`)}const a=o.body.getReader(),n=new TextDecoder;let i="",c="";for(;;){const{done:t,value:e}=await a.read();if(t)break;i+=n.decode(e,{stream:!0});const r=i.split("\n");i=r.pop();for(const t of r)if(t.startsWith("data: "))try{const e=JSON.parse(t.slice(6)),r=e.candidates?.[0]?.content?.parts?.[0]?.text;r&&(c+=r,this.root.innerHTML=c)}catch(t){}}await this.write(t,c),this.rehydrateScripts(this.root),history.replaceState(null,"",`#${t}`)}catch(t){this.root.innerHTML=`<pre>${t.message}</pre>`}}}})()</script>