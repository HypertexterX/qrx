<!DOCTYPE html><style>:root{color-scheme:dark}</style><app></app><script>(()=>{let e=document,t=window,r=t.location;os=new class{constructor(){this.name="os",this.storeName="files",this.root=e.querySelector("app"),this.plugins={},t.addEventListener("hashchange",()=>this.route()),this.boot()}async boot(){await this.connectDB(),await this.runBootloader(),await this.route()}connectDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.name,1);r.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName)},r.onsuccess=t=>{this.db=t.target.result,e()},r.onerror=t})}dbTx(e,t="readonly"){return this.db.transaction(this.storeName,e).objectStore(this.storeName)}async write(e,t){return new Promise(r=>{this.dbTx("readwrite").put(t,e).onsuccess=r})}async read(e){return new Promise(t=>{this.dbTx().get(e).onsuccess=e=>t(e.target.result)})}async getKeys(){return new Promise(e=>{this.dbTx().getAllKeys().onsuccess=t=>e(t.target.result)})}use(e,t){this.plugins[e]=t,"function"==typeof t&&t(this)}async runBootloader(){let e=(await this.getKeys()).filter(e=>e.startsWith("boot")).sort();for(let t of e){let e=await this.read(t);try{new Function("os",e)(this)}catch(e){console.error(`[Boot Error] ${t}:`,e)}}}async route(){let e=r.hash.slice(1)||"home",[t,a]=e.split("?"),o=new URLSearchParams(a);if(o.has("w")&&(await this.write(t,o.get("w")),history.replaceState(null,"",`#${t}`)),o.has("apiKey")){localStorage.setItem("apiKey",o.get("apiKey")),o.delete("apiKey");let e=o.toString()?`${t}?${o.toString()}`:t;history.replaceState(null,"",`#${e}`)}if(o.has("apiModel")){localStorage.setItem("apiModel",o.get("apiModel")),o.delete("apiModel");let e=o.toString()?`${t}?${o.toString()}`:t;history.replaceState(null,"",`#${e}`)}let s=localStorage.getItem("apiKey"),i=localStorage.getItem("apiModel")||"gemini-3-pro-preview";if(o.has("p"))return s?void await this.generateAndRender(t,s,i,r.href):void this.render("\n                  <h3>Configuration Required</h3>\n                  <p>No API Key found. Please add <code>?apiKey=YOUR_KEY</code> to the URL.</p>\n              ");let n=await this.read(t);this.render(n||`\n        <h3>Error #0x404</h3>\n        <p>File #${t} does not exist yet.</p>\n        <p>Use <code>?w=content</code> to create it manually, or <code>?p=prompt</code> to generate it.</p>\n    `)}render(e){this.root.innerHTML=e,this.rehydrateScripts(this.root)}rehydrateScripts(t){t.querySelectorAll("script").forEach(t=>{let r=e.createElement("script");Array.from(t.attributes).forEach(e=>{r.setAttribute(e.name,e.value)}),r.textContent=t.textContent,t.parentNode.replaceChild(r,t)})}async generateAndRender(e,t,r,a){this.root.innerHTML="<i>Thinking...</i>";let o={contents:[{parts:[{text:`<SYSTEM>You are an OS. Generate a valid HTML/JS Single Page App.</SYSTEM><CONTEXT>${await this.read(e)||""}</CONTEXT><USER_REQUEST>${a}</USER_REQUEST>`}]}]};try{let a=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${r}:streamGenerateContent?key=${t}&alt=sse`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!a.ok){let e=await a.text();throw new Error(`API Error ${a.status}: ${e}`)}let s=a.body.getReader(),i=new TextDecoder,n="",l="";for(;;){let{done:e,value:t}=await s.read();if(e)break;n+=i.decode(t,{stream:!0});let r=n.split("\n");n=r.pop();for(let e of r)if(e.startsWith("data: "))try{let t=JSON.parse(e.slice(6)),r=t.candidates?.[0]?.content?.parts?.[0]?.text;r&&(l+=r,this.root.innerHTML=l)}catch(e){}}await this.write(e,l),this.rehydrateScripts(this.root),history.replaceState(null,"",`#${e}`)}catch(e){this.root.innerHTML=`<pre>${e.message}</pre>`}}}})()</script>