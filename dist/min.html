<!DOCTYPE html><app id="A"></app><script>D=document,W=window,L=localStorage,H=history,J=JSON,O="os",F="files",ONS="onsuccess";class OS{constructor(){W.onhashchange=()=>this.R(),this.boot()}async boot(){await this.cdb();let t=(await this.keys()).filter(t=>t.startsWith("boot")).sort();for(let e of t)try{let t=await this.read(e)(new Function(O,t))(this)}catch(t){console.error(e,t)}this.R()}cdb(){return new Promise(t=>{let e=indexedDB.open(O);e.onupgradeneeded=t=>t.target.result.createObjectStore(F),e[ONS]=e=>{this.db=e.target.result,t()}})}tx(t="readonly"){return this.db.transaction(F,t).objectStore(F)}write(t,e){return new Promise(r=>this.tx("readwrite").put(e,t)[ONS]=r)}read(t){return new Promise(e=>this.tx().get(t)[ONS]=t=>e(t.target.result))}keys(){return new Promise(t=>this.tx().getAllKeys()[ONS]=e=>t(e.target.result))}async R(){let t=location.hash.slice(1)||"home",[e,r]=t.split("?"),a=new URLSearchParams(r);if(a.has("w"))return await this.write(e,a.get("w")),H.replaceState(0,"","#"+e);for(let t of["k","m","s","h"])a.has(t)&&(L.setItem(t,a.get(t)),a.delete(t),H.replaceState(0,"","#"+(a.toString()?`${e}?${a}`:e)));if(a.has("p"))return this.gen(e,a.get("p"));let s=await this.read(e);this.r(s||"404")}r(t){A.innerHTML=t,A.querySelectorAll("script").forEach(t=>{let e=D.createElement("script");Array.from(t.attributes).forEach(t=>e.setAttribute(t.name,t.value)),e.text=t.textContent,t.replaceWith(e)})}async gen(t,e){let r,a,s,[i,n,o,c]=["k","m","s","h"].map(t=>L.getItem(t)),h="google"==c,l=`<SYS>${o}</SYS><FILE>${await this.read(t)}</FILE><REQ>${e}</REQ>`,g=h?`https://generativelanguage.googleapis.com/v1beta/models/${n}:generateContent?key=${i}`:c,d=h?{contents:[{parts:[{text:l}]}]}:{model:n,messages:[{role:"user",content:l}]},u={"Content-Type":"application/json"};!h&&i&&(u.Authorization=`Bearer ${i}`),A.innerHTML="Thinking...";try{r=await fetch(g,{method:"POST",headers:u,body:J.stringify(d)}),a=await r.json(),s=h?a.candidates?.[0]?.content?.parts?.[0]?.text:a.choices?.[0]?.message?.content,s&&(await this.write(t,s),this.r(s),H.replaceState(0,"","#"+t))}catch(t){A.innerHTML=t}}}os=new OS</script>