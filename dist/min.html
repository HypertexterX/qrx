<!DOCTYPE html><style>:root{color-scheme:dark}</style><app></app><script>D=document,W=window,WL=W.location,H=history,O="os",F="files",L=localStorage,ONS="onsuccess";class OS{constructor(){this.root=D.querySelector("app"),this.plugins={},W.addEventListener("hashchange",()=>this.route()),this.boot()}async boot(){await this.connectDB(),await this.runBootloader(),await this.route()}connectDB(){return new Promise((e,t)=>{let r=indexedDB.open(O,1);r.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(F)||t.createObjectStore(F)},r[ONS]=t=>{this.db=t.target.result,e()},r.onerror=t})}dbTx(e="readonly"){return this.db.transaction(F,e).objectStore(F)}async write(e,t){return new Promise(r=>{this.dbTx("readwrite").put(t,e)[ONS]=r})}async read(e){return new Promise(t=>{this.dbTx().get(e)[ONS]=e=>t(e.target.result)})}async getKeys(){return new Promise(e=>{this.dbTx().getAllKeys()[ONS]=t=>e(t.target.result)})}use(e,t){this.plugins[e]=t,"function"==typeof t&&t(this)}async runBootloader(){let e=(await this.getKeys()).filter(e=>e.startsWith("boot")).sort();for(let t of e){let e=await this.read(t);try{new Function(O,e)(this)}catch(e){console.error(`[Boot Error] ${t}:`,e)}}}async route(){let e=WL.hash.slice(1)||"home",[t,r]=e.split("?"),a=new URLSearchParams(r);if(a.has("w")&&(await this.write(t,a.get("w")),H.replaceState(null,"",`#${t}`)),a.has("k")){L.setItem("k",a.get("k")),a.delete("k");let e=a.toString()?`${t}?${a.toString()}`:t;H.replaceState(null,"",`#${e}`)}if(a.has("m")){L.setItem("m",a.get("m")),a.delete("m");let e=a.toString()?`${t}?${a.toString()}`:t;H.replaceState(null,"",`#${e}`)}let o=L.getItem("k"),i=L.getItem("m")||"gemini-3-pro-preview";if(a.has("p"))return o?void await this.generateAndRender(t,o,i,WL.href):void this.render("<h3>Configuration Required</h3><p>No API Key found. Please add <code>?k=YOUR_KEY</code> to the URL.</p>");let n=await this.read(t);this.render(n||`<h3>Error #0x404</h3><p>File #${t} does not exist yet.</p><p>Use <code>?w=content</code> to create it manually, or <code>?p=prompt</code> to generate it.</p>`)}render(e){this.root.innerHTML=e,this.rehydrateScripts(this.root)}rehydrateScripts(e){e.querySelectorAll("script").forEach(e=>{let t=D.createElement("script");Array.from(e.attributes).forEach(e=>{t.setAttribute(e.name,e.value)}),t.textContent=e.textContent,e.parentNode.replaceChild(t,e)})}async generateAndRender(e,t,r,a){this.root.innerHTML="<i>Thinking...</i>";let o={contents:[{parts:[{text:`<SYSTEM>You are an OS. Generate a valid HTML/JS Single Page App.</SYSTEM><CONTEXT>${await this.read(e)||""}</CONTEXT><USER_REQUEST>${a}</USER_REQUEST>`}]}]};try{let a=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${r}:streamGenerateContent?key=${t}&alt=sse`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!a.ok){let e=await a.text();throw new Error(`API Error ${a.status}: ${e}`)}let i=a.body.getReader(),n=new TextDecoder,s="",l="";for(;;){let{done:e,value:t}=await i.read();if(e)break;s+=n.decode(t,{stream:!0});let r=s.split("\n");s=r.pop();for(let e of r)if(e.startsWith("data: "))try{let t=JSON.parse(e.slice(6)),r=t.candidates?.[0]?.content?.parts?.[0]?.text;r&&(l+=r,this.root.innerHTML=l)}catch(e){}}await this.write(e,l),this.rehydrateScripts(this.root),H.replaceState(null,"",`#${e}`)}catch(e){this.root.innerHTML=`<pre>${e.message}</pre>`}}}os=new OS</script>